Several minor errors of the original code have been fixed.
